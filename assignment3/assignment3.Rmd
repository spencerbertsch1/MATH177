---
title: "Assignment 3 - QBS 177"
output: html_notebook
---

Spencer Bertsch  
Jan. 2022

------------

Some helpful commands:  
* Insert a new code chunk: *Cmd+Option+I*  
* Run a code cell: *Cmd+Shift+Enter*  
* Preview the notebook HTML file: *Cmd+Shift+K*  


### Imports 
```{r}
library(glue)
```

First we need to change our current working directory to the correct directory for Assignment 3
```{r}
setwd('/Users/spencerbertsch/Desktop/dev/phd_courses/MATH177/assignment3')
getwd()
```

### Import the raw data 
```{r}
lung_df <- read.table("PCA.example1.txt",header=TRUE)
```


Here we examine the mean values of the columns. If the mean is NULL, that means there are NULL values in the dataframe that we need to fill with a method such as forward filling or mean value replacement.
```{r}
mu = colMeans(lung_df)
print(mu[0:5])
```



We can see from the above values of mu that there are NULL values in the dataframe. We need to fill thosw null values using a method such as forward filling or mean value replacement. 

```{r}
for(i in 1:ncol(lung_df)){
  lung_df[is.na(lung_df[,i]), i] <- round(mean(lung_df[,i], na.rm = TRUE))
}
sum(is.na(lung_df))
```

We can see from the 'mu_new' variable that we have successfully removed all of the NULL values from the columns. Let's continue. 
```{r}
mu_new = colMeans(lung_df)
print(mu_new[0:5])
```


### PCA using Spectral Decomposition
```{r}
start.time <- Sys.time()
# here we can perform PCA on the lung cancer dataset using spectral composition
lung.pc.eigen.cor <- prcomp(lung_df)

end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
```


We can now identify the principal components in our new dataframe
```{r}
names(lung.pc.eigen.cor)
lung.scores.eigen <- lung.pc.eigen.cor$x
lung.sdev.eigen <- lung.pc.eigen.cor$sdev
lung.rotation.eigen <- lung.pc.eigen.cor$rotation
lung.center.eigen <- lung.pc.eigen.cor$center
lung.scale.eigen <- lung.pc.eigen.cor$scale
```


#### We can see that the result of the prcomp() function is an array that contains several things: 
1. The standard deviations of the principal components. This is a vector with dimensions **1x(# variables)**
2. The rotations (loadings) of each variable. These are the matrix with dimensions **(# variables)x(# variables)**, each column corresponds to an eigenvector
3. The center is a vector displaying the centers of each column 
4. The scale, a boolean value showing whether or not centering and scaling was used. **False** in our case here. 
5. The x here refers to the rotated data. This is generated by taking the matrix product of the centered data and the rotation matrix described in (2) above. The dimensions of 'x' are **(# observations)x(# variables)**

\br
Knowing all of this, we can now take our rotation (loadings) and perform a matrix product with the initial, un-centered data set that we imported directly from the flat file. The result of this operation should be equal to 'x' above, or our rotated data. We can test this by examining the correlation between these values and the values of the rotated data pull directly from `lung.pc.eigen.cor$x`.
```{r}
pc1 <- (lung.pc.eigen.cor$rotation[,1]%*%t(lung_df))
cor(t(pc1), lung.scores.eigen[,1])
```

And indeed, we see that we get a correlation of 1. 

We can now work backwards and reconstruct the covariance matrix using the roatations (loadings) and the eigenvalues that were generated using the `prcomp` command. 

```{r}
# first we XXXX 
eigenvalue <- diag(lung.pc.eigen.cor$sdev^2)

# then we YYYY
newdata =(lung.pc.eigen.cor$rot)%*%eigenvalue%*%t(lung.pc.eigen.cor$rot)
```


And now we can check our work by comparing the resulting dataframe `newdata` against the actual covariance matrix of the initial lung_df dataframe. 
```{r}
covdata <- cov(lung_df)
sum(abs(newdata-covdata))
```



